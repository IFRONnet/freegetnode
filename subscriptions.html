<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/plain; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终的Base64订阅</title>
</head>
<body>

<script>
    // 订阅源URL和CORS代理
    const subscriptionUrl = 'https://getafreenode.com/subscribe/?uuid=88888888-8888-8888-8888-888888888888';
    const corsProxy = 'https://api.allorigins.win/get?url=';

    // 获取订阅信息
    async function fetchSubscriptionInfo() {
        try {
            // 通过CORS代理获取远程订阅信息
            const response = await fetch(corsProxy + encodeURIComponent(subscriptionUrl));
            if (!response.ok) {
                throw new Error('无法获取订阅信息');
            }

            const data = await response.json();
            const decodedContent = atob(data.contents); // Base64 解码

            // 生成去除广告的最终 Base64 订阅内容
            const finalBase64 = generateFinalBase64(decodedContent);

            // 输出纯文本格式的 Base64 订阅内容
            document.body.textContent = finalBase64; // 输出纯 Base64 内容

        } catch (error) {
            document.body.textContent = '获取订阅信息失败：' + error.message;
        }
    }

    // 生成去除广告的最终 Base64 编码
    function generateFinalBase64(decodedContent) {
        const lines = decodedContent.split('\n').map(line => {
            if (line.startsWith('vmess://')) {
                // 对 VMess 链接进行 Base64 解码
                const vmessDecoded = atob(line.slice(8)); // 去掉 'vmess://' 并解码 Base64
                const vmessReplaced = replaceKeywords(vmessDecoded); // 替换广告内容
                return 'vmess://' + btoa(vmessReplaced); // 重新编码为 Base64 并加上 'vmess://'
            } else {
                return replaceKeywords(line); // 对其他类型的链接进行广告替换
            }
        }).join('\n');
        return btoa(lines); // 将处理后的内容重新编码为 Base64
    }

    // 替换广告关键词
    function replaceKeywords(text) {
        return text.replace(/-GetAFreeNode\.com/g, '-getfreenode.pages.dev/')
                   .replace(/-GetAFreeNode/g, '-getfreenode.pages.dev/');
    }

    // 页面加载时调用获取订阅信息
    fetchSubscriptionInfo();
</script>

</body>
</html>
